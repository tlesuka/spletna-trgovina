<!DOCTYPE html>
<html lang="sl">
  <head>
    <meta charset="UTF-8" />
    <title>Košarica - MojaŠkatla</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap & Icons -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
      rel="stylesheet"
    />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="assets/css/navbar.css" />
    <link rel="stylesheet" href="assets/css/footer.css" />
    <link rel="stylesheet" href="assets/css/cart.css" />
  </head>
  <body class="d-flex flex-column min-vh-100">
    <div id="navbar-container"></div>

    <main class="flex-fill py-5">
      <div class="container">
        <h1 class="mb-4">Košarica</h1>

        <ul class="nav nav-pills justify-content-center mb-4 checkout-steps">
          <li class="nav-item">
            <span class="nav-link active">1. Košarica</span>
          </li>
          <li class="nav-item">
            <span class="nav-link disabled">2. Pregled naročila</span>
          </li>
          <li class="nav-item">
            <span class="nav-link disabled">3. Zaključek</span>
          </li>
        </ul>

        <div id="cart-items" class="mb-4"></div>

        <div class="card p-3">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <span class="fw-semibold">
                Skupaj: <span id="cart-total">0.00 €</span>
              </span>
            </div>
            <a href="checkout.html" class="btn btn-success">
              Nadaljuj na pregled
            </a>
          </div>
        </div>
      </div>
    </main>

    <div id="footer-container"></div>

    <script src="assets/js/includePartials.js"></script>
    <script src="assets/js/products.js"></script>
    <script src="assets/js/cart.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const cartItemsContainer = document.getElementById('cart-items');
        const totalElement = document.getElementById('cart-total');

        function renderCart() {
          const cart = getCart();
          cartItemsContainer.innerHTML = '';

          if (cart.length === 0) {
            cartItemsContainer.innerHTML = '<p>Košarica je prazna.</p>';
            totalElement.textContent = '0.00 €';
            return;
          }

          let total = 0;

          cart.forEach((item) => {
            const product = getProductById(item.id);
            if (!product) return;

            const lineTotal = product.price * item.quantity;
            total += lineTotal;

            const row = document.createElement('div');
            row.className =
              'cart-item d-flex align-items-center border-bottom py-3 gap-3';

            row.innerHTML = `
              <img src="${product.image}" alt="${
              product.name
            }" class="cart-item-image">
              <div class="flex-fill">
                <h5 class="mb-1">${product.name}</h5>
                <div class="text-muted small">
                  ${product.price.toFixed(2)} € / kos
                </div>
              </div>
              <div class="d-flex align-items-center gap-2">
                <input
                  type="number"
                  min="1"
                  class="form-control form-control-sm cart-qty-input"
                  value="${item.quantity}"
                  data-id="${product.id}"
                >
                <strong class="cart-line-total">${lineTotal.toFixed(
                  2
                )} €</strong>
                <button
                  class="btn btn-sm btn-outline-danger"
                  data-action="remove"
                  data-id="${product.id}"
                >
                  <i class="bi bi-trash"></i>
                </button>
              </div>
            `;

            cartItemsContainer.appendChild(row);
          });

          totalElement.textContent = total.toFixed(2) + ' €';
        }

        cartItemsContainer.addEventListener('input', (e) => {
          const input = e.target.closest('.cart-qty-input');
          if (!input) return;
          const id = Number(input.dataset.id);
          changeQuantity(id, input.value);
          renderCart();
        });

        cartItemsContainer.addEventListener('click', (e) => {
          const btn = e.target.closest('[data-action="remove"]');
          if (!btn) return;
          const id = Number(btn.dataset.id);
          removeFromCart(id);
          renderCart();
        });

        renderCart();
      });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
